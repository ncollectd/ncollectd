.\" SPDX-License-Identifier: GPL-2.0-only
.Dd @NCOLLECTD_DATE@
.Dt NCOLLECTD-VARNISH 5
.Os ncollectd @NCOLLECTD_VERSION@
.Sh NAME
.Nm ncollectd-varnish
.Nd Documentation of ncollectd's varnish plugin
.Sh SYNOPSIS
.Bd -literal -compact
\fBload-plugin\fP varnish
\fBplugin\fP varnish {
    \fBinstance\fP \fIname\fP {
        \fBvsh-instance\fP \fIvsh-name\fP
        \fBcollect\fP \fIflags\fP
        \fBlabel\fP \fIkey\fP \fIvalue\fP
        \fBinterval\fP \fIseconds\fP
        \fBfilter\fP {
            ...
        }
    }
}
.Ed
.Sh DESCRIPTION
The \fBvanish\fP plugin collects information about Varnish, an HTTP accelerator.
.Pp
The configuration consists of one or more \fBinstance\fP blocks.
Inside each \fBinstance\fP blocks, the following options are recognized:
.Bl -tag -width Ds
.It \fBvhs-instance\fP \fIvsh-instanace-name\fP
The \fIvsh-instanace-name\fP is the parameter passed to "varnishd -n".
If left empty, it will collectd statistics from the default "varnishd" instance
(this should work fine in most cases).
.It \fBlabel\fP \fIkey\fP \fIvalue\fP
.It \fBinterval\fP \fIseconds\fP
.It \fBcollect\fP \fIflags\fP
.Bl -tag -width Ds
.It \fBbackend\fP
Back-end connection statistics, such as successful, reused,
and closed connections.
Collected by default.
.It \fBcache\fP
Cache hits and misses.
Collected by default.
.It \fBconnections\fP
Number of client connections received, accepted and dropped.
Collected by default.
.It \fBdirdns\fP
DNS director lookup cache statistics.
Only available with Varnish 3.x.
Not collected by default.
.It \fBesi\fP
Edge Side Includes (ESI) parse statistics.
Not collected by default.
.It \fBfetch\fP
Statistics about fetches (HTTP requests sent to the backend).
Not collected by default.
.It \fBhcb\fP
Inserts and look-ups in the crit bit tree based hash.
Look-ups are divided into locked and unlocked look-ups.
Not collected by default.
.It \fBobjects\fP
Statistics on cached objects: number of objects expired, nuked (prematurely
expired), saved, moved, etc.
Not collected by default.
.It \fBban\fP
Statistics about ban operations, such as number of bans added, retired, and
number of objects tested against ban operations.
Not collected by default.
.It \fBsession\fP
Client session statistics.
Number of past and current sessions, session herd and linger counters, etc.
Not collected by default.
.It \fBshm\fP
Statistics about the shared memory log, a memory region to store
log messages which is flushed to disk when full.
Collected by default.
.It \fBsma\fP
Malloc or umem (
.Xr umem_alloc 3MALLOC
based) storage statistics.
The umem storage component is Solaris specific.
Note: SMA, SMF and MSE share counters, enable only the one used by
the Varnish instance.
Not collected by default.
.It \fBsms\fP
Synth (synthetic content) storage statistics.
This storage component is used internally only.
Not collected by default.
.It \fBstruct\fP
Current varnish internal state statistics.
Number of current sessions, objects in cache store etc.
Not collected by default.
.It \fBtotals\fP
Collects overview counters, such as the number of sessions created,
the number of requests and bytes transferred.
Not collected by default.
.It \fBuptime\fP
Varnish uptime.
Not collected by default.
.It \fBvcl\fP
Number of total (available + discarded) VCL (config files).
Not collected by default.
.It \fBworkers\fP
Collect statistics about worker threads.
Not collected by default.
.It \fBvsm\fP
Collect statistics about Varnish's shared memory usage (used by the logging and
statistics subsystems).
Only available with Varnish 4.x.
Not collected by default.
.It \fBlck\fP
Lock counters.
Not collected by default.
.It \fBmempool\fP
Memory pool counters.
Not collected by default.
.It \fBmgt\fP
Management process counters.
Not collected by default.
.It \fBsmf\fP
File (memory mapped file) storage statistics.
Note: SMA, SMF and MSE share counters, enable only the one used by
the Varnish instance.
.It \fBvbe\fP
Backend counters.
Only available with Varnish 4.x and above.
Not collected by default.
.It \fBmse\fP
Varnish Massive Storage Engine 2.0 (MSE2) is an improved storage backend for
Varnish, replacing the traditional malloc and file storages.
Only available with Varnish-Plus 4.x and above.
Note: SMA, SMF and MSE share counters, enable only the one used by
the Varnish instance.
Not collected by default.
.It \fBgoto\fP
vmod-goto counters.
Only available with Varnish Plus 6.x.
Not collected by default.
.It \fBsmu\fP
.It \fBbrotli\fP
.It \fBaccg_diag\fP
.It \fBaccg\fP
.It \fBworkspace\fP
.El
.It \fBfilter\fP
Configure a filter to modify or drop the metrics.
See \fBFILTER CONFIGURATION\fP in
.Xr ncollectd.conf 5 .
.El
.Sh "SEE ALSO"
.Xr ncollectd 1 ,
.Xr ncollectd.conf 5
